// William E. Boyce/Richard C. DiPrima, "Elementary Differential
// Equations and Boundary Value Problems 10th Ed." 第413頁-416頁 

using System;
using Matrix_0;

namespace ConsoleApp40
{
    internal class Program
    {
        static void Main(string[] args)
        {

// 初始值 [y1|y2|y3|y4] = [y1, y2, y3, y4]t
double[,] y0Start = { { -1 }, { 4 }, { 1 }, { 1 } };

// 系統矩陣A0，並Cast為實數矩陣類別A。 
double[,] A0 =  { {0, 0, 1, 0}, {0, 0, 0, 1}, 
    {-2, 1.5, 0, 0}, {1.33333, -3, 0, 0 } }; 
ReMatrix A = new ReMatrix(A0);

// 系統特徵值V和特徵向量Q。
EIG eig = new EIG(A);
CxMatrix D = eig.CxMatrixD;
CxMatrix V = eig.CxVector;
CxMatrix Q = eig.CxMatrixQ;

CxToHexp Hexp = new CxToHexp(D, Q, 0);
CxMatrix MatTemp = Hexp.GetCxMatrix;
CxMatrix d = ~MatTemp * y0Start;

// 列印系統與狀態狀態參數。
Console.Write("\n****{0,7}系{0,5}統{0,5}與{0,5}狀{0,5}態{0,5}參{0,5}數{0,7}****\n", "");

Console.Write("\n***{0,5}系統特徵值V{0,5}***\n{1}\n", "", new PR(V));
Console.Write("\n***{0,5}系統特徵向量Q{0,5}***\n{1}\n", "", new PR(Q));
Console.Write("\n***{0,5}係數向量d{0,5}***\n{1}\n", "", new PR(d));

double step = 0.5;
int iRow = (int)(20 / step + 1);
int iCol = 4 + 1;
ReMatrix Disp = new ReMatrix(iRow, iCol);
ReMatrix Vel = new ReMatrix(iRow, iCol);
    
for (int i = 0; i != iRow; i++)
{
    double t = step * i;

    Hexp = new CxToHexp(D, Q, t);
    MatTemp = Hexp.GetCxMatrix;
    CxMatrix yh_Cx = MatTemp * d;
    ReMatrix yh_Re = (ReMatrix)yh_Cx;
    ReMatrix yhDot_Re = A * yh_Re;

    Vel.Matrix[i, 0] = t;
    Vel.Matrix[i, 1] = yhDot_Re.Matrix[0, 0];
    Vel.Matrix[i, 2] = yhDot_Re.Matrix[1, 0];
    Vel.Matrix[i, 3] = yhDot_Re.Matrix[2, 0];
    Vel.Matrix[i, 4] = yhDot_Re.Matrix[3, 0];

    Disp.Matrix[i, 0] = t;
    Disp.Matrix[i, 1] = yh_Re.Matrix[0, 0];
    Disp.Matrix[i, 2] = yh_Re.Matrix[1, 0];
    Disp.Matrix[i, 3] = yh_Re.Matrix[2, 0];
    Disp.Matrix[i, 4] = yh_Re.Matrix[3, 0]; 
}

// 列印狀態響應，節點之變位與速度。 
Console.Write("\n****{0,10}狀{0,7}態{0,7}響{0,7}應{0,10}****\n", ""); 

Console.Write("\n{0,5}***位移反應量***{0,5}\n{0,8}時間(秒)" +
"{0,8}第0點位移{0,8}第1點位移{0,8}第2點位移{0,8}第3點位移\n\n{1}", 
"", new PR(Disp));
Console.Write("\n{0,5}***速度反應量***{0,5}\n{0,8}時間(秒)" +
"{0,8}第0點速度{0,8}第1點速度{0,8}第2點速度{0,8}第3點速度\n\n{1}", 
"", new PR(Vel));

//列印時間、節點變位、和速度等序列。
Console.Write("\n時間序列 : \n{0}\n", 
    new PR4(Disp, 0, "{0,8:F2}")); 

Console.Write("\n第0點變位序列 : \n{0}\n", new PR4(Disp, 1));
Console.Write("\n第1點變位序列 : \n{0}\n", new PR4(Disp, 2));
Console.Write("\n第2點變位序列 : \n{0}\n", new PR4(Disp, 3));
Console.Write("\n第3點變位序列 : \n{0}\n", new PR4(Disp, 4));

Console.Write("\n第0點速度序列 : \n{0}\n", new PR4(Vel, 1));
Console.Write("\n第1點速度序列 : \n{0}\n", new PR4(Vel, 2));
Console.Write("\n第2點速度序列 : \n{0}\n", new PR4(Vel, 3));
Console.Write("\n第3點速度序列 : \n{0}\n", new PR4(Vel, 4));
        }
    }
}

/*
****       系     統     與     狀     態     參     數       ****

***     系統特徵值V     ***
    0.00000  +    2.00000i
    0.00000  -    2.00000i
    0.00000  +    1.00000i
    0.00000  -    1.00000i

***     系統特徵向量Q     ***
   0.26833 +   0.00000i,   0.26833 +   0.00000i, 
   0.58835 +   0.00000i,   0.58835 +   0.00000i  

  -0.35777 +   0.00000i,  -0.35777 +   0.00000i,  
   0.39223 +   0.00000i,   0.39223 +   0.00000i  

   0.00000 +   0.53666i,   0.00000 -   0.53666i,  
   0.00000 +   0.58835i,   0.00000 -   0.58835i

   0.00000 -   0.71554i,   0.00000 +   0.71554i,  
   0.00000 +   0.39223i,   0.00000 -   0.39223i

***     係數向量d     ***
  -4.34791 +   0.15528i
  -4.34791 -   0.15528i
   1.13312 -   0.99148i
   1.13312 +   0.99148i

****          狀       態       響       應          ****

 ***位移反應量***
  時間(秒)     第0點位移    第1點位移   第2點位移    第3點位移
   0.00000    -1.00000     4.00000     1.00000     1.00000
   0.50000     0.39861     2.92740     4.22143    -4.85934
   1.00000     2.59735    -0.05890     3.82114    -6.07807
   1.50000     3.55628    -2.22559    -0.42391    -1.92973
   2.00000     2.09422    -1.78033    -5.12071     3.43180
   2.50000    -0.95195     0.52930    -6.25489     4.87459
   3.00000    -3.37247     2.18591    -2.80712     1.05653
   3.50000    -3.47172     1.31324     2.31547    -4.33692
   4.00000    -1.49741    -1.51237     4.88775    -6.02401
   4.50000     0.67012    -3.73650     3.13254    -2.06181
   5.00000     1.26265    -3.16458    -0.78940     4.27155
   5.50000     0.19478    -0.01617    -2.89986     7.40148
   6.00000    -0.97002     3.20187    -1.15191     4.52138
   6.50000    -0.59930     3.90525     2.66204    -1.84436
   7.00000     1.37008     1.71661     4.60360    -6.13102
   7.50000     3.27492    -1.25354     2.31503    -4.77925
   8.00000     3.21878    -2.37122    -2.67283     0.58596
   8.50000     0.85105    -0.87698    -6.20766     4.74287
   9.00000    -2.21220     1.48150    -5.22715     3.74458
   9.50000    -3.73672     2.14779    -0.52853    -1.42160
  10.00000    -2.78174     0.20207     3.93885    -5.75888
  10.50000    -0.45205    -2.71797     4.61385    -4.91549
  11.00000     1.17324    -3.88580     1.46388     0.72516
  11.50000     0.93687    -2.00303    -2.12908     6.30103
  12.00000    -0.41512     1.55180    -2.59682     6.86227
  12.50000    -1.04874     3.90439     0.46965     1.87883
  13.00000     0.12709     3.23080     3.94922    -4.26873
  13.50000     2.33292     0.35139     4.13413    -6.26749
  14.00000     3.56151    -2.07266     0.26339    -2.67379
  14.50000     2.41824    -1.98940    -4.63288     2.85593
  15.00000    -0.53184     0.20058    -6.38988     5.01313
  15.50000    -3.16447     2.09180    -3.45480     1.77279
  16.00000    -3.60526     1.58146     1.70088    -3.73459
  16.50000    -1.81931    -1.10814     4.79808    -6.13822
  17.00000     0.44740    -3.57353     3.57138    -2.84011
  17.50000     1.29869    -3.42282    -0.29067     3.50129
  18.00000     0.38555    -0.50547    -2.83528     7.32375
  18.50000    -0.87916     2.87854    -1.57804     5.20953
  19.00000    -0.76006     3.99971     2.17747    -0.99603
  19.50000     1.06505     2.11504     4.57430    -5.85699
  20.00000     3.10328    -0.91931     2.84719    -5.27863

 ***速度反應量***
   時間(秒)    第0點速度   第1點速度    第2點速度   第3點速度 
   0.00000     1.00000     1.00000     8.00000   -13.33333
   0.50000     4.22143    -4.85934     3.59387    -8.25071
   1.00000     3.82114    -6.07807    -5.28306     3.63983
   1.50000    -0.42391    -1.92973   -10.45095    11.41847
   2.00000    -5.12071     3.43180    -6.85893     8.13327
   2.50000    -6.25489     4.87459     2.69784    -2.85716
   3.00000    -2.80712     1.05653    10.02381   -11.05435
   3.50000     2.31547    -4.33692     8.91329    -8.56866
   4.00000     4.88775    -6.02401     0.72627     2.54057
   4.50000     3.13254    -2.06181    -6.94499    12.10300
   5.00000    -0.78940     4.27155    -7.27217    11.17726
   5.50000    -2.89986     7.40148    -0.41382     0.30822
   6.00000    -1.15191     4.52138     6.74285   -10.89896
   6.50000     2.66204    -1.84436     7.05647   -12.51482
   7.00000     4.60360    -6.13102    -0.16524    -3.32305
   7.50000     2.31503    -4.77925    -8.43015     8.12717
   8.00000    -2.67283     0.58596    -9.99438    11.40534
   8.50000    -6.20766     4.74287    -3.01757     3.76567
   9.00000    -5.22715     3.74458     6.64665    -7.39409
   9.50000    -0.52853    -1.42160    10.69513   -11.42566
  10.00000     3.93885    -5.75888     5.86658    -4.31519
  10.50000     4.61385    -4.91549    -3.17286     7.55119
  11.00000     1.46388     0.72516    -8.17518    13.22171
  11.50000    -2.12908     6.30103    -4.87829     7.25825
  12.00000    -2.59682     6.86227     3.15794    -5.20890
  12.50000     0.46965     1.87883     7.95406   -13.11149
  13.00000     3.94922    -4.26873     4.59201    -9.52294
  13.50000     4.13413    -6.26749    -4.13876     2.05639
  14.00000     0.26339    -2.67379   -10.23202    10.96666
  14.50000    -4.63288     2.85593    -7.82058     9.19252
  15.00000    -6.38988     5.01313     1.36455    -1.31085
  15.50000    -3.45480     1.77279     9.46664   -10.49468
  16.00000     1.70088    -3.73459     9.58271    -9.55138
  16.50000     4.79808    -6.13822     1.97641     0.89869
  17.00000     3.57138    -2.84011    -6.25509    11.31711
  17.50000    -0.29067     3.50129    -7.73160    12.00003
  18.00000    -2.83528     7.32375    -1.52930     2.03046
  18.50000    -1.57804     5.20953     6.07614    -9.80784
  19.00000     2.17747    -0.99603     7.51969   -13.01254
  19.50000     4.57430    -5.85699     1.04246    -4.92505
  20.00000     2.84719    -5.27863    -7.58552     6.89562

時間序列 :
    0.00,    0.50,    1.00,    1.50,    2.00,
    2.50,    3.00,    3.50,    4.00,    4.50,
    5.00,    5.50,    6.00,    6.50,    7.00,
    7.50,    8.00,    8.50,    9.00,    9.50,
   10.00,   10.50,   11.00,   11.50,   12.00,
   12.50,   13.00,   13.50,   14.00,   14.50,
   15.00,   15.50,   16.00,   16.50,   17.00,
   17.50,   18.00,   18.50,   19.00,   19.50,
   20.00,

第0點變位序列 :
  -1.0000,     0.3986,     2.5974,     3.5563,     2.0942,
  -0.9519,    -3.3725,    -3.4717,    -1.4974,     0.6701,
   1.2627,     0.1948,    -0.9700,    -0.5993,     1.3701,
   3.2749,     3.2188,     0.8510,    -2.2122,    -3.7367,
  -2.7817,    -0.4520,     1.1732,     0.9369,    -0.4151,
  -1.0487,     0.1271,     2.3329,     3.5615,     2.4182,
  -0.5318,    -3.1645,    -3.6053,    -1.8193,     0.4474,
   1.2987,     0.3855,    -0.8792,    -0.7601,     1.0651,
   3.1033,

第1點變位序列 :
   4.0000,     2.9274,    -0.0589,    -2.2256,    -1.7803,
   0.5293,     2.1859,     1.3132,    -1.5124,    -3.7365,
  -3.1646,    -0.0162,     3.2019,     3.9053,     1.7166,
  -1.2535,    -2.3712,    -0.8770,     1.4815,     2.1478,
   0.2021,    -2.7180,    -3.8858,    -2.0030,     1.5518,
   3.9044,     3.2308,     0.3514,    -2.0727,    -1.9894,
   0.2006,     2.0918,     1.5815,    -1.1081,    -3.5735,
  -3.4228,    -0.5055,     2.8785,     3.9997,     2.1150,
  -0.9193,

第2點變位序列 :
   1.0000,     4.2214,     3.8211,    -0.4239,    -5.1207,
  -6.2549,    -2.8071,     2.3155,     4.8878,     3.1325,
  -0.7894,    -2.8999,    -1.1519,     2.6620,     4.6036,
   2.3150,    -2.6728,    -6.2077,    -5.2271,    -0.5285,
   3.9389,     4.6138,     1.4639,    -2.1291,    -2.5968,
   0.4697,     3.9492,     4.1341,     0.2634,    -4.6329,
  -6.3899,    -3.4548,     1.7009,     4.7981,     3.5714,
  -0.2907,    -2.8353,    -1.5780,     2.1775,     4.5743,
   2.8472,

第3點變位序列 :
   1.0000,    -4.8593,    -6.0781,    -1.9297,     3.4318,
   4.8746,     1.0565,    -4.3369,    -6.0240,    -2.0618,
   4.2716,     7.4015,     4.5214,    -1.8444,    -6.1310,
  -4.7792,     0.5860,     4.7429,     3.7446,    -1.4216,
  -5.7589,    -4.9155,     0.7252,     6.3010,     6.8623,
   1.8788,    -4.2687,    -6.2675,    -2.6738,     2.8559,
   5.0131,     1.7728,    -3.7346,    -6.1382,    -2.8401,
   3.5013,     7.3237,     5.2095,    -0.9960,    -5.8570,
  -5.2786,

第0點速度序列 :
   1.0000,     4.2214,     3.8211,    -0.4239,    -5.1207,
  -6.2549,    -2.8071,     2.3155,     4.8878,     3.1325,
  -0.7894,    -2.8999,    -1.1519,     2.6620,     4.6036,
   2.3150,    -2.6728,    -6.2077,    -5.2271,    -0.5285,
   3.9389,     4.6138,     1.4639,    -2.1291,    -2.5968,
   0.4697,     3.9492,     4.1341,     0.2634,    -4.6329,
  -6.3899,    -3.4548,     1.7009,     4.7981,     3.5714,
  -0.2907,    -2.8353,    -1.5780,     2.1775,     4.5743,
   2.8472,

第1點速度序列 :
   1.0000,    -4.8593,    -6.0781,    -1.9297,     3.4318,
   4.8746,     1.0565,    -4.3369,    -6.0240,    -2.0618,
   4.2716,     7.4015,     4.5214,    -1.8444,    -6.1310,
  -4.7792,     0.5860,     4.7429,     3.7446,    -1.4216,
  -5.7589,    -4.9155,     0.7252,     6.3010,     6.8623,
   1.8788,    -4.2687,    -6.2675,    -2.6738,     2.8559,
   5.0131,     1.7728,    -3.7346,    -6.1382,    -2.8401,
   3.5013,     7.3237,     5.2095,    -0.9960,    -5.8570,
  -5.2786,

第2點速度序列 :
   8.0000,     3.5939,    -5.2831,   -10.4510,    -6.8589,
   2.6978,    10.0238,     8.9133,     0.7263,    -6.9450,
  -7.2722,    -0.4138,     6.7429,     7.0565,    -0.1652,
  -8.4302,    -9.9944,    -3.0176,     6.6467,    10.6951,
   5.8666,    -3.1729,    -8.1752,    -4.8783,     3.1579,
   7.9541,     4.5920,    -4.1388,   -10.2320,    -7.8206,
   1.3646,     9.4666,     9.5827,     1.9764,    -6.2551,
  -7.7316,    -1.5293,     6.0761,     7.5197,     1.0424,
  -7.5855,

第3點速度序列 :
 -13.3333,    -8.2507,     3.6398,    11.4185,     8.1333,
  -2.8572,   -11.0544,    -8.5687,     2.5406,    12.1030,
  11.1773,     0.3082,   -10.8990,   -12.5148,    -3.3230,
   8.1272,    11.4053,     3.7657,    -7.3941,   -11.4257,
  -4.3152,     7.5512,    13.2217,     7.2582,    -5.2089,
 -13.1115,    -9.5229,     2.0564,    10.9667,     9.1925,
  -1.3109,   -10.4947,    -9.5514,     0.8987,    11.3171,
  12.0000,     2.0304,    -9.8078,   -13.0125,    -4.9250,
   6.8956,

請按任意鍵繼續 . . .
*/